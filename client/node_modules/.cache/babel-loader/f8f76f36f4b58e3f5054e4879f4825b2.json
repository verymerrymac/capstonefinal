{"ast":null,"code":"var parse = require('../_parsers/parse');\n\nvar Image = require('../../image/Image');\n\nvar sisterProjects = {\n  wikt: 'wiktionary',\n  commons: 'commons',\n  c: 'commons',\n  commonscat: 'commonscat',\n  n: 'wikinews',\n  q: 'wikiquote',\n  s: 'wikisource',\n  a: 'wikiauthor',\n  b: 'wikibooks',\n  voy: 'wikivoyage',\n  v: 'wikiversity',\n  d: 'wikidata',\n  species: 'wikispecies',\n  m: 'meta',\n  mw: 'mediawiki'\n};\nvar parsers = {\n  //same in every language.\n  citation: function citation(tmpl, r) {\n    var obj = parse(tmpl);\n    r.templates.push(obj);\n    return '';\n  },\n  //https://en.wikipedia.org/wiki/Template:Book_bar\n  'book bar': function bookBar(tmpl, r) {\n    var obj = parse(tmpl);\n    r.templates.push(obj);\n    return '';\n  },\n  //https://en.wikipedia.org/wiki/Template:Main\n  main: function main(tmpl, r) {\n    var obj = parse(tmpl);\n    r.templates.push(obj);\n    return '';\n  },\n  'wide image': function wideImage(tmpl, r) {\n    var obj = parse(tmpl, ['file', 'width', 'caption']);\n    r.templates.push(obj);\n    return '';\n  },\n  //https://en.wikipedia.org/wiki/Template:Redirect\n  redirect: function redirect(tmpl, r) {\n    var data = parse(tmpl, ['redirect']);\n    var list = data.list || [];\n    var links = [];\n\n    for (var i = 0; i < list.length; i += 2) {\n      links.push({\n        page: list[i + 1],\n        desc: list[i]\n      });\n    }\n\n    var obj = {\n      template: 'redirect',\n      redirect: data.redirect,\n      links: links\n    };\n    r.templates.push(obj);\n    return '';\n  },\n  //this one sucks - https://en.wikipedia.org/wiki/Template:GNIS\n  'cite gnis': function citeGnis(tmpl, r) {\n    var order = ['id', 'name', 'type'];\n    var obj = parse(tmpl, order);\n    obj.type = 'gnis';\n    obj.template = 'citation';\n    r.templates.push(obj);\n    return '';\n  },\n  'sfn': function sfn(tmpl, r) {\n    var order = ['author', 'year', 'location'];\n    var obj = parse(tmpl, order);\n    r.templates.push(obj);\n    return '';\n  },\n  'audio': function audio(tmpl, r) {\n    var order = ['file', 'text', 'type'];\n    var obj = parse(tmpl, order);\n    r.templates.push(obj);\n    return '';\n  },\n  //https://en.wikipedia.org/wiki/Template:Portal\n  'portal': function portal(tmpl, r) {\n    var obj = parse(tmpl);\n    r.templates.push(obj);\n    return '';\n  },\n  'spoken wikipedia': function spokenWikipedia(tmpl, r) {\n    var order = ['file', 'date'];\n    var obj = parse(tmpl, order);\n    obj.template = 'audio';\n    r.templates.push(obj);\n    return '';\n  },\n  //https://en.wikipedia.org/wiki/Template:Sister_project_links\n  'sister project links': function sisterProjectLinks(tmpl, r) {\n    var data = parse(tmpl); //rename 'wd' to 'wikidata'\n\n    var links = {};\n    Object.keys(sisterProjects).forEach(function (k) {\n      if (data.hasOwnProperty(k) === true) {\n        links[sisterProjects[k]] = data[k]; //.text();\n      }\n    });\n    var obj = {\n      template: 'sister project links',\n      links: links\n    };\n    r.templates.push(obj);\n    return '';\n  },\n  //https://en.wikipedia.org/wiki/Template:Subject_bar\n  'subject bar': function subjectBar(tmpl, r) {\n    var data = parse(tmpl);\n    Object.keys(data).forEach(function (k) {\n      //rename 'voy' to 'wikivoyage'\n      if (sisterProjects.hasOwnProperty(k)) {\n        data[sisterProjects[k]] = data[k];\n        delete data[k];\n      }\n    });\n    var obj = {\n      template: 'subject bar',\n      links: data\n    };\n    r.templates.push(obj);\n    return '';\n  },\n  'short description': function shortDescription(tmpl, r) {\n    var data = parse(tmpl, ['description']);\n\n    if (data['1']) {\n      console.log(\"~=~=~**here**~=~\");\n      data.description = data['1'];\n      delete data['1'];\n    }\n\n    r.templates.push(data);\n    return '';\n  },\n  'good article': function goodArticle(tmpl, r) {\n    var obj = {\n      template: 'Good article'\n    };\n    r.templates.push(obj);\n    return '';\n  },\n  'coord missing': function coordMissing(tmpl, r) {\n    var obj = parse(tmpl, ['region']);\n    r.templates.push(obj);\n    return '';\n  },\n  //amazingly, this one does not obey any known patterns\n  //https://en.wikipedia.org/wiki/Template:Gallery\n  'gallery': function gallery(tmpl, r) {\n    var obj = parse(tmpl);\n    var images = (obj.list || []).filter(function (line) {\n      return /^ *File ?:/.test(line);\n    });\n    images = images.map(function (file) {\n      var img = {\n        file: file\n      };\n      return new Image(img).json();\n    });\n    obj = {\n      template: 'gallery',\n      images: images\n    };\n    r.templates.push(obj);\n    return '';\n  },\n  //https://en.wikipedia.org/wiki/Template:See_also\n  'see also': function seeAlso(tmpl, r) {\n    var data = parse(tmpl);\n    r.templates.push(data);\n    return '';\n  },\n  'italic title': function italicTitle(tmpl, r) {\n    r.templates.push({\n      template: 'italic title'\n    });\n    return '';\n  },\n  'unreferenced': function unreferenced(tmpl, r) {\n    var obj = parse(tmpl, ['date']);\n    r.templates.push(obj);\n    return '';\n  }\n}; //aliases\n\nparsers['cite'] = parsers.citation;\nparsers['sfnref'] = parsers.sfn;\nparsers['harvid'] = parsers.sfn;\nparsers['harvnb'] = parsers.sfn;\nparsers['unreferenced section'] = parsers.unreferenced;\nparsers['redir'] = parsers.redirect;\nparsers['sisterlinks'] = parsers['sister project links'];\nparsers['main article'] = parsers['main'];\nmodule.exports = parsers;","map":null,"metadata":{},"sourceType":"script"}