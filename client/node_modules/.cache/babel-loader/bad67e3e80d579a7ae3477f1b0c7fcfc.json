{"ast":null,"code":"var site_map = require('../_data/site_map');\n\nvar request = require('./_request');\n\nvar getParams = require('./_params');\n\nvar normalizeCategory = function normalizeCategory() {\n  var cat = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n\n  if (/^Category/i.test(cat) === false) {\n    cat = 'Category:' + cat;\n  }\n\n  cat = cat.replace(/ /g, '_');\n  return cat;\n};\n\nvar makeUrl = function makeUrl(cat, lang) {\n  cat = encodeURIComponent(cat);\n  var url = \"https://\".concat(lang, \".wikipedia.org/w/api.php\");\n\n  if (site_map[lang]) {\n    url = site_map[lang] + '/w/api.php';\n  }\n\n  url += \"?action=query&list=categorymembers&cmtitle=\".concat(cat, \"&cmlimit=500&format=json&origin=*&redirects=true&cmtype=page|subcat\");\n  return url;\n};\n\nvar addResult = function addResult(body, out) {\n  if (body.query && body.query.categorymembers) {\n    var list = body.query.categorymembers;\n    list.forEach(function (p) {\n      if (p.ns === 14) {\n        out.categories.push(p);\n      } else {\n        out.pages.push(p);\n      }\n    });\n    return out;\n  }\n\n  return out;\n};\n\nvar getCategories = function getCategories(cat, a, b, c) {\n  var _getParams = getParams(a, b, c),\n      lang = _getParams.lang,\n      options = _getParams.options,\n      callback = _getParams.callback; //cleanup cat name\n\n\n  cat = normalizeCategory(cat);\n  var url = makeUrl(cat, lang, options);\n  var safety = 0;\n  var output = {\n    category: cat,\n    pages: [],\n    categories: []\n  };\n\n  var doit = function doit() {\n    var cntd = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var cb = arguments.length > 1 ? arguments[1] : undefined;\n    var myUrl = url + '&cmcontinue=' + cntd;\n    var p = request(myUrl, options);\n    p.then(function (body) {\n      output = addResult(body, output); //should we do another?\n\n      if (body.continue && body.continue.cmcontinue && body.continue.cmcontinue !== cntd && safety < 25) {\n        safety += 1;\n        doit(body.continue.cmcontinue, cb);\n      } else {\n        cb(null, output);\n      }\n    });\n  };\n\n  return new Promise(function (resolve, reject) {\n    doit('', function (err) {\n      if (typeof callback === 'function') {\n        callback(err, output);\n      }\n\n      if (err) {\n        reject(err);\n      }\n\n      resolve(output);\n    });\n  });\n};\n\nmodule.exports = getCategories;","map":null,"metadata":{},"sourceType":"script"}