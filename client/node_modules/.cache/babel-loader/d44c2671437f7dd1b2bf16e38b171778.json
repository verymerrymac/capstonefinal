{"ast":null,"code":"var parseSentence = require('../../04-sentence/').oneSentence;\n\nvar Image = require('../../image/Image'); //okay, <gallery> is a xml-tag, with newline-seperated data, somehow pivoted by '|'...\n//all deities help us. truly -> https://en.wikipedia.org/wiki/Help:Gallery_tag\n// - not to be confused with https://en.wikipedia.org/wiki/Template:Gallery...\n\n\nvar parseGallery = function parseGallery(wiki, section) {\n  wiki = wiki.replace(/<gallery([^>]*?)>([\\s\\S]+?)<\\/gallery>/g, function (_, attrs, inside) {\n    var images = inside.split(/\\n/g);\n    images = images.filter(function (str) {\n      return str && str.trim() !== '';\n    }); //parse the line, which has an image and sometimes a caption\n\n    images = images.map(function (str) {\n      var arr = str.split(/\\|/);\n      var obj = {\n        file: arr[0].trim()\n      };\n      var img = new Image(obj).json();\n      var caption = arr.slice(1).join('|');\n\n      if (caption !== '') {\n        img.caption = parseSentence(caption);\n      }\n\n      return img;\n    }); //add it to our templates list\n\n    if (images.length > 0) {\n      section.templates.push({\n        template: 'gallery',\n        images: images\n      });\n    }\n\n    return '';\n  });\n  return wiki;\n};\n\nmodule.exports = parseGallery;","map":null,"metadata":{},"sourceType":"script"}