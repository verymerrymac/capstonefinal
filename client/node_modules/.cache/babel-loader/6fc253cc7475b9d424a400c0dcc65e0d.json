{"ast":null,"code":"var tableParser = require('../table/parse'); //https://en.wikipedia.org/wiki/Template:MLB_game_log_section\n//this is pretty nuts\n\n\nvar whichHeadings = function whichHeadings(tmpl) {\n  var headings = ['#', 'date', 'opponent', 'score', 'win', 'loss', 'save', 'attendance', 'record'];\n\n  if (/\\|stadium=y/i.test(tmpl) === true) {\n    headings.splice(7, 0, 'stadium'); //save, stadium, attendance\n  }\n\n  if (/\\|time=y/i.test(tmpl) === true) {\n    headings.splice(7, 0, 'time'); //save, time, stadium, attendance\n  }\n\n  if (/\\|box=y/i.test(tmpl) === true) {\n    headings.push('box'); //record, box\n  }\n\n  return headings;\n};\n\nvar parseMlb = function parseMlb(wiki, section) {\n  wiki = wiki.replace(/\\{\\{mlb game log (section|month)[\\s\\S]+?\\{\\{mlb game log (section|month) end\\}\\}/gi, function (tmpl) {\n    var headings = whichHeadings(tmpl);\n    tmpl = tmpl.replace(/^\\{\\{.*?\\}\\}/, '');\n    tmpl = tmpl.replace(/\\{\\{mlb game log (section|month) end\\}\\}/i, '');\n    var headers = '! ' + headings.join(' !! ');\n    var table = '{|\\n' + headers + '\\n' + tmpl + '\\n|}';\n    var rows = tableParser(table);\n    rows = rows.map(function (row) {\n      Object.keys(row).forEach(function (k) {\n        row[k] = row[k].text();\n      });\n      return row;\n    });\n    section.templates.push({\n      template: 'mlb game log section',\n      data: rows\n    });\n    return '';\n  });\n  return wiki;\n};\n\nmodule.exports = parseMlb;","map":null,"metadata":{},"sourceType":"script"}