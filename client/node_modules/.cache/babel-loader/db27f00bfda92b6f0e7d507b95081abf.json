{"ast":null,"code":"var parse = require('../_parsers/parse');\n\nvar hasMonth = /^jan /i;\nvar isYear = /^year /i;\nvar monthList = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];\n\nvar toNumber = function toNumber(str) {\n  str = str.replace(/,/g, '');\n  str = str.replace(/−/g, '-');\n  var num = Number(str);\n\n  if (isNaN(num)) {\n    return str;\n  }\n\n  return num;\n};\n\nvar templates = {\n  // this one is a handful!\n  //https://en.wikipedia.org/wiki/Template:Weather_box\n  'weather box': function weatherBox(tmpl, r) {\n    var obj = parse(tmpl); //collect all month-based data\n\n    var byMonth = {};\n    var properties = Object.keys(obj).filter(function (k) {\n      return hasMonth.test(k);\n    });\n    properties = properties.map(function (k) {\n      return k.replace(hasMonth, '');\n    });\n    properties.forEach(function (prop) {\n      byMonth[prop] = [];\n      monthList.forEach(function (m) {\n        var key = \"\".concat(m, \" \").concat(prop);\n\n        if (obj.hasOwnProperty(key)) {\n          var num = toNumber(obj[key]);\n          delete obj[key];\n          byMonth[prop].push(num);\n        }\n      });\n    }); //add these to original\n\n    obj.byMonth = byMonth; //collect year-based data\n\n    var byYear = {};\n    Object.keys(obj).forEach(function (k) {\n      if (isYear.test(k)) {\n        var prop = k.replace(isYear, '');\n        byYear[prop] = obj[k];\n        delete obj[k];\n      }\n    });\n    obj.byYear = byYear;\n    r.templates.push(obj);\n    return '';\n  },\n  //The 36 parameters are: 12 monthly highs (C), 12 lows (total 24) plus an optional 12 monthly rain/precipitation\n  //https://en.wikipedia.org/wiki/Template:Weather_box/concise_C\n  'weather box/concise c': function weatherBoxConciseC(tmpl, r) {\n    var obj = parse(tmpl);\n    obj.list = obj.list.map(function (s) {\n      return toNumber(s);\n    });\n    obj.byMonth = {\n      'high c': obj.list.slice(0, 12),\n      'low c': obj.list.slice(12, 24),\n      'rain mm': obj.list.slice(24, 36)\n    };\n    delete obj.list;\n    obj.template = 'weather box';\n    r.templates.push(obj);\n    return '';\n  },\n  'weather box/concise f': function weatherBoxConciseF(tmpl, r) {\n    var obj = parse(tmpl);\n    obj.list = obj.list.map(function (s) {\n      return toNumber(s);\n    });\n    obj.byMonth = {\n      'high f': obj.list.slice(0, 12),\n      'low f': obj.list.slice(12, 24),\n      'rain inch': obj.list.slice(24, 36)\n    };\n    delete obj.list;\n    obj.template = 'weather box';\n    r.templates.push(obj);\n    return '';\n  },\n  //https://en.wikipedia.org/wiki/Template:Climate_chart\n  'climate chart': function climateChart(tmpl, r) {\n    var list = parse(tmpl).list || [];\n    var title = list[0];\n    var source = list[38];\n    list = list.slice(1); //amazingly, they use '−' symbol here instead of negatives...\n\n    list = list.map(function (str) {\n      if (str && str[0] === '−') {\n        str = str.replace(/−/, '-');\n      }\n\n      return str;\n    });\n    var months = []; //groups of three, for 12 months\n\n    for (var i = 0; i < 36; i += 3) {\n      months.push({\n        low: toNumber(list[i]),\n        high: toNumber(list[i + 1]),\n        precip: toNumber(list[i + 2])\n      });\n    }\n\n    var obj = {\n      template: 'climate chart',\n      data: {\n        title: title,\n        source: source,\n        months: months\n      }\n    };\n    r.templates.push(obj);\n    return '';\n  }\n};\nmodule.exports = templates;","map":null,"metadata":{},"sourceType":"script"}